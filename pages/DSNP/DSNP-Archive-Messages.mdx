import { Image } from "@chakra-ui/react";

## Specification Status

| Version | Status |
---------- | ---------
| 0.1     | Proposed |

## Purpose
1. Specify the Archivist message format

## Archive Entry
An archive entry is a combination of data in a DSNP message and from the block in which it is included.
It is a key-value map consisting of the following fields:

|field|description|type|
|---|---|---|
| `author` | social identity of author of the content. | bytes |
| `blockHeight` | the block number this message was included in | number |
| `fromAddress`| social identity of message sender | bytes |
| `logIndex` | the index within the logs of this message | number
| `messageID` | keccak-256 hash of this data, minus the messageID |  bytes32
| `messageType` | DSNP message type |number/enum. see [DSNP Message Types](/DSNP/DSNP-Message-Types) |
| `messageData` | DSNP message data | see fields in [DSNP Messages](/DSNP/DSNP-Messages) |
| `signatures` | list of additional signatures referencing this message | array of Signatures |
| `transactionIndex` | the index of the transaction this message is associated with | number

### DETAILS
### `author`
* bytes
* The social identity of the composer of the message data. This may be the same as `fromAddress`, however, if the author is different, it means the message sender is a delegated sender of this message, authorized by `author`.  Validators may opt to verify that the sender is authorized, however, this will be enforced by the social identity contract.

### `blockHeight`
* number
* The block in which this DSNP Message is included.

### `fromAddress`
* bytes
* The contract address of the message sender.  This may be the same as `author`. If different from    `author`, it means the message sender is a delegated sender of this message, authorized by `author`.  Validators may opt to verify that the sender is authorized, however, this will be enforced by the social identity contract.

### `logIndex`
* number
* The log index in which this DSNP Message is included

### `messageID`
* bytes32
* The keccak-256 hash of all of this data in a keccak-256 hash with the messageID field being blank. In other words, produce the hash with messageID set to 0-length bytes, then set messageID to the result.

### `messageType`
   * number
   * Indicates what type of message this is, useful for indexers and filters.

### `messageData`
   * varies
   * This can be encrypted, and/or serialized, and compressed where feasible.  The decrypted, fully deserialzed version must be one of the types described in [DSNP Messages](/DSNP/DSNP-Messages).

### `signatures`
   * array
   * all the signatures applied to this message at the time of archival.

### `transactionIndex`
   * number
   * The transaction index in which this DSNP Message is included

## Batch
A _Batch_ is data that is referenced by a Batch Announcement.

|field|description|type|
|---|---|---|
| messageID | keccak-256 hash of content stored at uri |  bytes32
| fromAddress| social identity of batch announcer,i.e. message sender | bytes |
| signature | announcer's signature | Signature |

*  List of Validated Announcements
    * announcementID  = Keccak256 hash of the content found at uri →
        * Announcement archival data
        * ServiceNodeID-1 -> signature, result
        * ServiceNodeID-2 -> signature, result
        * …
        * ServiceNodeID-N -> signature, result

## Archive Segment
An archive segment is a clump of data that is archived. It consists of a map of messageIDs pointing to either:
* A list of announcements from 1 or more batches
* Independently posted announcements

## Signature
A Signature consists of two fields:
* `signature` - A [secp256k1](https://en.bitcoin.it/wiki/Secp256k1) signature
* `result` - optional, bytes. A result of an operation performed. For example, if a signing entity wished to prove that they had performed some sort of validation or analysis on the message, they would put the result of the analysis in this field. It could be a meaningful number or string, some sort of proof hash, etc.

## Diagram
<Image src="DSNP/images/ArchiveDiagram.png" />
