---
name: Signatures
route: /Messages/Signatures
menu: Messages
---

# Message Signatures

DSNP messages provided for batching should include a [keccak-256](https://en.wikipedia.org/wiki/SHA-3) hash of their content and a signature generated from said hash for the purposes of verifying the authenticity of the message and indexing by authorization as described in the identity specification.
In the case of public and private broadcast messages, the contents to be hashed are the activity pub JSON data at their given URIs.
In the case of all other messages, the contents to be hashed is the DSNP message data itself.
Optionally, anonymous messages may be provided with a zero hash in place of the signature, however behavior for these messages is undefined, and they may be treated as invalid data by archivists or disregarded as spam by indexers or end clients.

Additionally, more signatures may be provided in the contents of messages for the purposes of verification without access to the indexing batch file, supporting better cryptographic signature methods as they become available, or adding verifiable attributes to DSNP messages.

## Specification Status

| Version | Status |
---------- | ---------
| 0.1     | Tentative |

## Purpose
1. Describe the method of signing DSNP messages for inclusion in batches
1. Describe additional methods of signing DSNP messages for extensible future use

## Assumptions
* All assumptions from [DSNP Messages](/Messages/Overview)

## Broadcast Message Signatures

Broadcast messages should be provided with a signature, conforming to the standards below, to archivists for the purposes of generating archive files.
Optionally, archivists may choose to accept anonymous broadcast messages with a zero hash provided in place of the signature, however this behavior is not required as it allows for more spam and may potentially expose a denial of service attack against archivists.
Anonymous messages may also be ignored by indexers, end clients and users at their own discretion.

While message signatures must be included archive entries generated by archivists, they generally will not be included in the broadcasts messages themselves.
Optionally, these signatures as well as others, may be added to the activity pub contents of a broadcast message to allow users to verify the contents of an activity pub event without downloading an archive file.
Additional signatures may as be used to extend this specification with new features such as verifiable attributes.

### Archive Entry Signatures

The process for generating a signature to be provided with a DSNP message to an archivist is as follows:

1. Remove any additional signatures from the message's activity pub contents.
1. Hash the serialized JSON using [keccak-256](https://en.wikipedia.org/wiki/SHA-3).
1. Sign the hash using [secp256k1](https://www.secg.org/sec2-v2.pdf).

### Additional Signatures

Additional signatures, including but not limited to the archive entry signature, may be added to a broadcast message's activity pub contents under a "signatures" key.
Each additional signature must include at minimum 3 keys: `"purpose"`, `"algorithm"` and `"value"`.
For example:

```
{
  "@context": "https://www.w3.org/ns/activitystreams",
  "type": "Person",
  "id": "https://social.example/alyssa/",
  ...
  "signatures": [
    {
      "purpose": "publisher",
      "algorithm": "dsnp-base64-ed25519",
      "value": "YpOHiDHAwC/6mLfw0aS+WC5/se0VlIRKxFneTHgqtHswvg2zmlOoLElBVCVl3aNd1CiyL5v1a0z0wTC2bj/2DA=="
    }
  ]
}
```

The `"purpose"` key defines what the signature is intended to prove.
In the case of the archive entry signature, the value should be `"publisher"` meaning that it proves who published the object.
The `"publisher"` value should be reserved for this particular use.
Additional purpose values, such as "author" or "editor," may be defined by this specification or the community in the future.

The `"algorithm"` key defines what cryptographic algorithm is used for the signature.
In the case of the archive entry signature, the value should be `"dsnp-base64-ed25519"` meaning that the signature is a base 64 encoding of an [secp256k1](https://www.secg.org/sec2-v2.pdf) signature of the activity pub object after being processed according to the steps listed in the prior section.
Implementers may define more algorithm values in the future, but in the interest of namespace cleanliness, those values should follow a similar pattern, with the authoring developer or organization first followed by the encoding and finally the encryption method each separated with a hyphen.

The `"value"` key hold the signature itself, and it's format depends on the chosen algorithm.
In the archive entry case, the value will be a string, but for certain signature algorithms, it may be a number or object.

Other keys and values may be added to signatures as necessary for a given purpose or algorithm.

## Non-broadcast Message Signatures

TBD.
