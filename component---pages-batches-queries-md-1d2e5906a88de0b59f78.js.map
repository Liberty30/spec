{"version":3,"sources":["webpack:///../pages/Batches/Queries.md"],"names":["_frontmatter","layoutProps","MDXLayout","DefaultLayout","MDXContent","components","props","mdxType","parentName","isMDXComponent"],"mappings":"uPAQaA,G,UAAe,S,0MAC5B,IAAMC,EAAc,CAClBD,gBAEIE,EAAYC,IACH,SAASC,EAAT,GAGZ,IAFDC,EAEC,EAFDA,WACGC,EACF,8BACD,OAAO,YAACJ,EAAD,eAAeD,EAAiBK,EAAhC,CAAuCD,WAAYA,EAAYE,QAAQ,cAG5E,kBACE,GAAM,WADR,WAGA,wFACA,kBACE,GAAM,wBADR,wBAGA,yBACE,qBAAOC,WAAW,SAChB,kBAAIA,WAAW,SACb,kBAAIA,WAAW,KACb,MAAS,MADX,WAGA,kBAAIA,WAAW,KACb,MAAS,MADX,YAKJ,qBAAOA,WAAW,SAChB,kBAAIA,WAAW,SACb,kBAAIA,WAAW,KACb,MAAS,MADX,OAGA,kBAAIA,WAAW,KACb,MAAS,MADX,YAMN,kBACE,GAAM,WADR,WAGA,sBACE,kBAAIA,WAAW,MAAf,0CACA,kBAAIA,WAAW,MAAf,iDAEF,kBACE,GAAM,eADR,eAGA,sBACE,kBAAIA,WAAW,MAAf,wBAA6C,iBAAGA,WAAW,KACvD,KAAQ,sBADiC,mBAI/C,kBACE,GAAM,yBADR,yBAGA,+WAGA,kBACE,GAAM,WADR,WAGA,sCAAqB,iBAAGA,WAAW,IAC/B,KAAQ,4CADS,gBAArB,yMAIA,8IACA,qBAAG,sBAAQA,WAAW,KAAnB,8DACH,uBAAK,oBAAMA,WAAW,MAClB,UAAa,uBADZ,quB,wMA0BTJ,EAAWK,gBAAiB","file":"component---pages-batches-queries-md-1d2e5906a88de0b59f78.js","sourcesContent":["import * as React from 'react'\n  /* @jsx mdx */\nimport { mdx } from '@mdx-js/react';\n/* @jsxRuntime classic */\n\n/* @jsx mdx */\n\nimport DefaultLayout from \"/home/runner/work/spec/spec/node_modules/gatsby-theme-docz/src/base/Layout.js\";\nexport const _frontmatter = {};\nconst layoutProps = {\n  _frontmatter\n};\nconst MDXLayout = DefaultLayout;\nexport default function MDXContent({\n  components,\n  ...props\n}) {\n  return <MDXLayout {...layoutProps} {...props} components={components} mdxType=\"MDXLayout\">\n\n\n    <h1 {...{\n      \"id\": \"queries\"\n    }}>{`Queries`}</h1>\n    <p>{`This specification describes how Batch files should be queried.`}</p>\n    <h2 {...{\n      \"id\": \"specification-status\"\n    }}>{`Specification Status`}</h2>\n    <table>\n      <thead parentName=\"table\">\n        <tr parentName=\"thead\">\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Version`}</th>\n          <th parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Status`}</th>\n        </tr>\n      </thead>\n      <tbody parentName=\"table\">\n        <tr parentName=\"tbody\">\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`0.1`}</td>\n          <td parentName=\"tr\" {...{\n            \"align\": null\n          }}>{`Draft`}</td>\n        </tr>\n      </tbody>\n    </table>\n    <h2 {...{\n      \"id\": \"purpose\"\n    }}>{`Purpose`}</h2>\n    <ol>\n      <li parentName=\"ol\">{`Specify how Batch files may be queried`}</li>\n      <li parentName=\"ol\">{`Outline the API to be implemented in the SDK`}</li>\n    </ol>\n    <h2 {...{\n      \"id\": \"assumptions\"\n    }}>{`Assumptions`}</h2>\n    <ul>\n      <li parentName=\"ul\">{`All assumptions from `}<a parentName=\"li\" {...{\n          \"href\": \"/Messages/Overview\"\n        }}>{`DSNP Messages`}</a></li>\n    </ul>\n    <h2 {...{\n      \"id\": \"goals-of-batch-design\"\n    }}>{`Goals of Batch Design`}</h2>\n    <p>{`We wish to minimize the number of queries needed and the amount of data clients must retrieve in order to get data the client wants.\nThis is to be balanced with avoiding operational overhead of a database, which would do indexing and support more advanced queries.\nIt is anticipated that indexing services would fill this need if it arises.`}</p>\n    <h2 {...{\n      \"id\": \"details\"\n    }}>{`Details`}</h2>\n    <p>{`Following the `}<a parentName=\"p\" {...{\n        \"href\": \"https://github.com/apache/parquet-format\"\n      }}>{`Parquet spec`}</a>{`, the query values are hashed and the Bloom filter in the batch file is pulled from the file and checked for that hash.\nOnly valid DSNP message fields, that is, columns in Parquet, can be checked.`}</p>\n    <p>{`Here is an example use case of how a batch file containing Broadcasts might be queried for a specific social address.`}</p>\n    <p><strong parentName=\"p\">{`NOTE the following SDK functions don't exist at this time`}</strong></p>\n    <pre><code parentName=\"pre\" {...{\n        \"className\": \"language-typescript\"\n      }}>{`function getLatestPostsFrom(socialAddress: string, lastLogin: Date): Array<DSNPMessage> {\n\n    const lastLoginBlock = sdk.timestampToBlockHeight(lastLogin)\n\n    const batches: Array<Batch> = sdk.getBatchesSince(lastLoginBlock)\n    let matchUrls: Array<string>\n\n    const query: Record<Keys,Type> = { fromAddress: socialAddress }\n\n    batches.map(batchUrl => {\n        // fetch the BloomFilters from the URLs provided and check the filters\n        // for the hashed value\n        if (sdk.bloomFilterQuery(batchUrl, query)) matchUrls.push(batchUrl)\n    })\n\n    // this function fetches each batch file, then returns rows\n    // matching fromAddress === socialAddress\n    return sdk.batchQuery(matchUrls, query)\n}\n`}</code></pre>\n\n    </MDXLayout>;\n}\n;\nMDXContent.isMDXComponent = true;\n      "],"sourceRoot":""}